import{a as V}from"./chunk-M22ORLB2.js";import{Ab as M,Ba as h,Fa as g,Ma as l,Oa as o,Pa as r,Ra as b,Sa as C,Ta as f,Ua as u,Va as a,Wa as I,X as m,Xa as s,Y as p,Ya as y,Za as x,_a as w,db as O,eb as D,fb as S,sa as n,wa as v,wb as E,xb as T,yb as k,zb as H}from"./chunk-7GLGVXCR.js";function P(t,i){if(t&1&&(b(0),o(1,"div",9)(2,"span",10),s(3),r()(),o(4,"div",11),s(5,"Order History"),r(),C()),t&2){let e=a();n(3),x("Hello \u{1F44B} ",e.username,"")}}function j(t,i){t&1&&(o(0,"div",11),s(1,"Order History"),r())}function $(t,i){t&1&&(o(0,"div",12),s(1,"Loading..."),r())}function N(t,i){if(t&1&&(o(0,"div",13),s(1),r()),t&2){let e=a();n(),y(e.error)}}function z(t,i){if(t&1){let e=f();o(0,"div",20)(1,"div",21)(2,"div",22),s(3),r(),o(4,"button",23),u("click",function(){let c=m(e).$implicit,_=a(2);return p(_.confirmDelete("item",c.id))}),s(5," \u{1F5D1}\uFE0F "),r()(),o(6,"div",24),s(7),r()()}if(t&2){let e=i.$implicit;n(3),w("",e.item," \xD7",e.quantity,""),n(4),x(" ",e.notes," ")}}function q(t,i){if(t&1){let e=f();o(0,"div",14)(1,"div",15)(2,"div",16)(3,"h3",17),s(4),r(),o(5,"button",18),u("click",function(){let c=m(e).$implicit,_=a();return p(_.confirmDelete("group",c.key))}),s(6," Delete Group "),r()(),g(7,z,8,3,"div",19),r()()}if(t&2){let e=i.$implicit,d=a();n(4),y(e.key),n(),l("disabled",d.deleting),n(2),l("ngForOf",e.value)}}function R(t,i){if(t&1&&(o(0,"div",25),s(1),r()),t&2){let e=a();l("ngClass",e.toastType==="success"?"bg-green-600":"bg-red-600"),n(),x(" ",e.toastMessage,`
`)}}function B(t,i){if(t&1){let e=f();o(0,"div",26)(1,"div",27)(2,"h3",28),s(3,"Are you sure you want to delete?"),r(),o(4,"div",29)(5,"button",30),u("click",function(){m(e);let c=a();return p(c.cancelDelete())}),s(6,"Cancel"),r(),o(7,"button",31),u("click",function(){m(e);let c=a();return p(c.proceedDelete())}),s(8),r()()()()}if(t&2){let e=a();n(7),l("disabled",e.deleting),n(),x(" ",e.deleting?"Deleting...":"Yes, Delete"," ")}}var F=class t{constructor(i){this.orderService=i}groupedOrders={};loading=!1;error=null;showModal=!1;modalType=null;pendingPrompt="";pendingItemId="";deleting=!1;toastMessage="";toastType="";get username(){return localStorage.getItem("username")||""}get uuid(){return localStorage.getItem("uuid")||""}ngOnInit(){this.fetchOrders()}fetchOrders(){this.loading=!0,this.orderService.getGroupedOrders().subscribe({next:i=>{this.groupedOrders=i,this.loading=!1},error:()=>{this.error="Failed to load order history",this.loading=!1}})}confirmDelete(i,e){this.modalType=i,this.showModal=!0,this.pendingPrompt=i==="group"?e:"",this.pendingItemId=i==="item"?e:""}cancelDelete(){this.showModal=!1,this.modalType=null,this.pendingPrompt="",this.pendingItemId=""}proceedDelete(){this.deleting=!0,(this.modalType==="group"?this.orderService.deletePrompt(this.pendingPrompt):this.orderService.deleteItem(this.pendingItemId)).subscribe({next:()=>{this.toastMessage="Deleted successfully",this.toastType="success",this.afterDelete()},error:()=>{this.toastMessage="Delete failed",this.toastType="error",this.afterDelete()}})}afterDelete(){this.deleting=!1,this.showModal=!1,this.pendingPrompt="",this.pendingItemId="",this.fetchOrders(),setTimeout(()=>this.toastMessage="",3e3)}static \u0275fac=function(e){return new(e||t)(v(V))};static \u0275cmp=h({type:t,selectors:[["app-order-history"]],decls:11,vars:9,consts:[["plainRec",""],[1,"max-w-4xl","mx-auto","p-6"],[1,"text-3xl","font-bold","mb-1"],[4,"ngIf","ngIfElse"],["class","text-gray-500",4,"ngIf"],["class","text-red-500",4,"ngIf"],["class","mb-6",4,"ngFor","ngForOf"],["class","fixed bottom-6 right-6 px-4 py-2 rounded shadow-lg text-white text-sm z-50",3,"ngClass",4,"ngIf"],["class","fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",4,"ngIf"],[1,"text-black"],[1,"text-[#e0b84a]"],[1,"text-[#E63946]"],[1,"text-gray-500"],[1,"text-red-500"],[1,"mb-6"],[1,"bg-white","border","border-gray-300","rounded-xl","shadow-sm","p-5"],[1,"flex","justify-between","items-center","mb-4"],[1,"font-semibold","text-gray-800","text-base"],[1,"text-sm","border","border-gray-300","text-red-600","px-3","py-1","rounded","hover:bg-red-100","hover:text-red-800","transition",3,"click","disabled"],["class","mb-4",4,"ngFor","ngForOf"],[1,"mb-4"],[1,"flex","justify-between","items-center"],[1,"font-semibold","text-gray-900"],["aria-label","Delete item",1,"text-sm","text-white","bg-red-100","hover:bg-red-300","p-1.5","rounded-full","shadow","transition",3,"click"],[1,"bg-gray-100","text-sm","mt-1","p-2","rounded","border","border-gray-300","text-gray-700"],[1,"fixed","bottom-6","right-6","px-4","py-2","rounded","shadow-lg","text-white","text-sm","z-50",3,"ngClass"],[1,"fixed","inset-0","bg-black","bg-opacity-40","flex","items-center","justify-center","z-50"],[1,"bg-white","p-6","rounded-xl","shadow-lg","w-full","max-w-sm"],[1,"text-lg","font-semibold","mb-4","text-gray-800"],[1,"flex","justify-end","gap-4"],[1,"px-4","py-2","bg-gray-200","text-gray-700","rounded","hover:bg-gray-300",3,"click"],[1,"px-4","py-2","bg-red-600","text-white","rounded","hover:bg-red-700",3,"click","disabled"]],template:function(e,d){if(e&1&&(o(0,"div",1)(1,"h2",2),g(2,P,6,1,"ng-container",3)(3,j,2,0,"ng-template",null,0,S),r(),g(5,$,2,0,"div",4)(6,N,2,1,"div",5)(7,q,8,3,"div",6),O(8,"keyvalue"),r(),g(9,R,2,2,"div",7)(10,B,9,2,"div",8)),e&2){let c=I(4);n(2),l("ngIf",d.username)("ngIfElse",c),n(3),l("ngIf",d.loading),n(),l("ngIf",d.error),n(),l("ngForOf",D(8,7,d.groupedOrders)),n(2),l("ngIf",d.toastMessage),n(),l("ngIf",d.showModal)}},dependencies:[M,E,T,k,H],encapsulation:2})};export{F as OrderHistoryComponent};
